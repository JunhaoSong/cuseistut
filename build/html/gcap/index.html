

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Focal mechanism &mdash; CUSeisTut</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Earthquake Transformer Tutorial" href="../eqt/index.html" />
    <link rel="prev" title="Earthquake Absolute Location" href="../abs_loc/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> CUSeisTut
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">CUSeisTut</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Entry level</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../unix/index.html">Unix commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GMT6-1/index.html">Generic Mapping Tools - Topographic Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GMT6-2/index.html">Generic Mapping Tools - Seismic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../obspy-1/index.html">Seismic data request via ObsPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../obspy-2/index.html">Seismic data process via ObsPy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Intermediate level</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sta_lta/index.html">Earthquake Detection STA/LTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../abs_loc/index.html">Earthquake Absolute Location</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced level</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Focal mechanism</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">1 Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-focal-mechanism">1.1 What is focal mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-required">1.2 package required</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation">2 Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fk">2.1 fk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#seismic-analysis-code-sac">2.2 Seismic Analysis Code (SAC)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#apply-sac-source-file">Apply SAC source file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-for-linux">2.2.1 Installation for linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-for-macos">2.2.2 Installation for MacOS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gcap3d">2.3 gCAP3D</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-processing">3 Data processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#green-s-function-calculation">3.1 Green‚Äôs function calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sac-file-preparation">3.2 Sac file preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#focal-mechanism-inversion">3.3 Focal mechanism inversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uncertainty-analysis">3.3 Uncertainty analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../eqt/index.html">Earthquake Transformer Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dd_loc/index.html">Double-Difference Earthquake Relocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source_spectra/index.html">Spectral Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pylith_static/index.html">Static Stress Change - PyLith</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pylith_dynamic/index.html">Dynamic Rupture Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../body_tomo/index.html">Body Wave Tomography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../surface_tomo/index.html">Surface Wave Tomography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ambient_tomo/index.html">Ambient noise cross correlation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/forms/d/e/1FAIpQLScSQIcOtANjTonJDhK4KYmoA6H2lUHou9Mqz1oFCHSTd5wxhQ/viewform?usp=sf_link">Give us feedback here</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CUSeisTut</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Focal mechanism</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/gcap/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="focal-mechanism">
<h1>Focal mechanism<a class="headerlink" href="#focal-mechanism" title="Permalink to this heading">¬∂</a></h1>
<p>Waveforms recorded at a seismic station, W(t), compose of three components:</p>
<p>W(t) = S(t) * G(t) * I(t);            (1)</p>
<p>where S(t) represents the source, G(t) stands for the Green‚Äôs functions, and I(t) is the instrument
response. Therefore, retrieving source parameters of one earthquake S(t) requires deconvolving
instrument response I(t) and Green‚Äôs functions G(t) from the actual data W(t).
We generally remove instrument responses after obtaining the waveform data. Therefore, we
have the data in displacement or in velocity, u(t) = S(t) * G(t). The corresponding synthetic
displacement s(t) for a douple-couple source can be expressed as</p>
<p>s(t) = M0 ‚àë Ai(œï -Œ∏,Œ≤,Œª)Gi(t);              (2)</p>
<p>where Gi are the Green‚Äôs functions, Ai are the radiation coeffcients, and œï is the station azimuth,
M0 is scalar moment,Œ∏,Œ≤, and Œª are strike, dip, and rake, respectively. Then we perform a grid
search in all possible solutions of strike, dip, and rake to obtain the best fit by finding the minimal
residual between the data and synthetics. This procedure consists of the following three steps, (1)
computing Green‚Äôs functions, (2) preparing data seismograms, and (3) deriving focal mechanism
solutions. This tutorial will mostly cover step (3).</p>
<p>Here we compute focal mechanism solutions using the Cut and Paste‚Äù method (CAP) [Zhu
and Helmberger, 1996]. This method decomposes seismograms and uses amplitude information in
different time windows (e.g., Pnl/surface wave) to increase the stability and resolution of focal
mechanism solution. Please refer to [Zhu and Helmberger, 1996] for details of the CAP method.
The earthquake example used in the gCAP program is the 2008 Illinois Mw 5.2 earthquake. It is
a left-lateral strike-slip event based on focal mechanism solutions and aftershock locations [Yang
et al., 2009].</p>
<blockquote>
<div><p>‚Äî‚Äî‚Äì Prof. Hongfeng Yang</p>
</div></blockquote>
<p>Developed by Han CHEN.</p>
<section id="introduction">
<h2>1 Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¬∂</a></h2>
<section id="what-is-focal-mechanism">
<h3>1.1 What is focal mechanism<a class="headerlink" href="#what-is-focal-mechanism" title="Permalink to this heading">¬∂</a></h3>
<p>To describe the geometry of a fault, Scientists assume that the fault is a planar surface across which slip occurred
during an earthquake. The focal mechanism describes the fault geometry of the seismogenic fault (e.g., strike(Œ∏), dip(Œ≤)) and
the slip in the fault (e.g., rake(Œª)). The beach ball were the lower-hemisphere stereographic projection of the fault geometry.</p>
<a class="reference internal image-reference" href="../_images/focal-mechanism.png"><img alt="../_images/focal-mechanism.png" src="../_images/focal-mechanism.png" style="width: 50%;" /></a>
</section>
<section id="package-required">
<h3>1.2 package required<a class="headerlink" href="#package-required" title="Permalink to this heading">¬∂</a></h3>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">fk</span></code> package</p></li>
<li><p>Seismic Analysis Code (<code class="file docutils literal notranslate"><span class="pre">SAC</span></code>) package</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">gCAP3D</span></code> package</p></li>
</ul>
</section>
</section>
<section id="installation">
<h2>2 Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¬∂</a></h2>
<section id="fk">
<h3>2.1 fk<a class="headerlink" href="#fk" title="Permalink to this heading">¬∂</a></h3>
<p>fk is a program written by Prof. Lupei ZHU for calculating the synthetic Green‚Äôs function based on a horizontally layered velocity model. The detailed installation of fk could be find on <a class="reference external" href="https://seismo-learn.org/software/fk/install/">here</a>.</p>
<p><em>1. Files download</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>## Download
<span class="linenos">2</span>$ wget http://www.eas.slu.edu/People/LZhu/downloads/fk3.3.tar
<span class="linenos">3</span>## Unzip
<span class="linenos">4</span>$ tar -xvf fk3.3.tar
<span class="linenos">5</span>## make dir &quot;~/Src&quot; and move the fold to &quot;~/Src&quot;
<span class="linenos">6</span>$ mkdir -p ~/Src/
<span class="linenos">7</span>$ mv fk ~/Src/
</pre></div>
</div>
<p><em>2. File modification and compilation</em></p>
<p>There are some errors in the source code of fk. Please <a class="reference download internal" download="" href="../_downloads/2fec236a31e63d450ccf6fed5d3ce6f8/fk3.3-v20190618.patch"><code class="xref download docutils literal notranslate"><span class="pre">download</span></code></a> the file and put it into the <code class="file docutils literal notranslate"><span class="pre">~/Src/fk</span></code> for modifying the Make file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ cd ~/Src/fk/
<span class="linenos">2</span>## modify the Make file
<span class="linenos">3</span>$ patch &lt; fk3.3-v20190618.patch
<span class="linenos">4</span>## compilation
<span class="linenos">5</span>$ make clean
<span class="linenos">6</span>$ make
<span class="linenos">7</span>## Modify the environment variable and add the fk path to PATH
<span class="linenos">8</span>$ echo &#39;export PATH=${HOME}/Src/fk/:${PATH}&#39;&gt;&gt; ~/.bashrc
<span class="linenos">9</span>$ source ~/.bashrc
</pre></div>
</div>
<p><em>3. Run fk</em></p>
<p>Type <code class="file docutils literal notranslate"><span class="pre">fk.pl</span></code> in the terminal, there will be help information if installation is succeeded</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ fk.pl
<span class="linenos">2</span>Usage: fk.pl -Mmodel/depth[/f_or_k] [-D] [-Hf1/f2] [-Nnt/dt/smth/dk/taper] [-Ppmin/pmax[/kmax]] [-Rrdep] [-SsrcType] [-Uupdn] [-Xcmd] distances ...
<span class="linenos">3</span>...
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="seismic-analysis-code-sac">
<h3>2.2 Seismic Analysis Code (SAC)<a class="headerlink" href="#seismic-analysis-code-sac" title="Permalink to this heading">¬∂</a></h3>
<p>SAC is one of the most widely used data analysis software packages in the field of natural seismology. The installation of SAC could be found at <a class="reference external" href="https://seisman.github.io/SAC_Docs_zh/install/">the website</a>.</p>
<section id="apply-sac-source-file">
<h4>Apply SAC source file<a class="headerlink" href="#apply-sac-source-file" title="Permalink to this heading">¬∂</a></h4>
<p>You will need to submit an application online to obtain the SAC package from IRISÔºö<a class="reference external" href="http://ds.iris.edu/ds/nodes/dmc/forms/sac/">http://ds.iris.edu/ds/nodes/dmc/forms/sac/</a></p>
</section>
<section id="installation-for-linux">
<h4>2.2.1 Installation for linux<a class="headerlink" href="#installation-for-linux" title="Permalink to this heading">¬∂</a></h4>
<p><em>1. Install dependent libraries</em></p>
<p>&gt; for Ubuntu/Debian:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ sudo apt update
<span class="linenos">2</span>$ sudo apt install libc6 libsm6 libice6 libxpm4 libx11-6
<span class="linenos">3</span>$ sudo apt install zlib1g libncurses5
</pre></div>
</div>
<p>&gt; for CentOS/Fedora/RHEL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ sudo yum install glibc libSM libICE libXpm libX11
<span class="linenos">2</span>$ sudo yum install zlib ncurses-compat-libs
</pre></div>
</div>
<p><em>2. Install binary packages</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>## Unizp
<span class="linenos">2</span>$ tar -xvf sac-102.0-linux_x86_64.tar.gz
<span class="linenos">3</span>## Move to installation position
<span class="linenos">4</span>$ sudo mv sac ~/opt
</pre></div>
</div>
<p><em>3. Configuration variable</em></p>
<p>Add the environment variables and SAC global variables in <code class="file docutils literal notranslate"><span class="pre">~/.bashrc</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ echo &#39;export SACHOME=~/opt/sac&#39;&gt;&gt; ~/.bashrc
<span class="linenos">2</span>$ echo &#39;export SACAUX=${SACHOME}/aux&#39;&gt;&gt; ~/.bashrc
<span class="linenos">3</span>$ echo &#39;export PATH=${SACHOME}/bin:${PATH}&#39;&gt;&gt; ~/.bashrc
<span class="linenos">4</span>$ echo &#39;export SAC_DISPLAY_COPYRIGHT=1&#39;&gt;&gt; ~/.bashrc
<span class="linenos">5</span>$ echo &#39;export SAC_PPK_LARGE_CROSSHAIRS=1&#39;&gt;&gt; ~/.bashrc
<span class="linenos">6</span>$ echo &#39;export SAC_USE_DATABASE=0&#39;&gt;&gt; ~/.bashrc
<span class="linenos">7</span>$ source ~/.bashrc
</pre></div>
</div>
<p><em>4. Run sac</em></p>
<p>Type <code class="file docutils literal notranslate"><span class="pre">sac</span></code> in the terminal, there will be version information if installation is succeeded</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ sac
<span class="linenos">2</span> SEISMIC ANALYSIS CODE [11/11/2    3 (Version 1    .6a)]
<span class="linenos">3</span> Copyright 1995 Regents of the University of California
<span class="linenos">4</span>
<span class="linenos">5</span>SAC&gt;
</pre></div>
</div>
</section>
<section id="installation-for-macos">
<h4>2.2.2 Installation for MacOS<a class="headerlink" href="#installation-for-macos" title="Permalink to this heading">¬∂</a></h4>
<p><em>1. Preparation</em></p>
<p>Install command line tools and X11 graphical interface related tools (XQuartzunder) MacOS</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ xcode-select --install
<span class="linenos">2</span>$ brew install --cask xquartz
</pre></div>
</div>
<p><em>2. Install binary packages</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>## Unizp
<span class="linenos">2</span>$ tar -xvf sac-102.0-mac.tar.gz
<span class="linenos">3</span>## Move to installation position
<span class="linenos">4</span>$ sudo mv sac ~/opt
</pre></div>
</div>
<p><em>3. Configuration variable</em></p>
<p>Add the environment variables and SAC global variables in <code class="file docutils literal notranslate"><span class="pre">~/.zshrc</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ echo &#39;export SACHOME=~/opt/sac&#39;&gt;&gt; ~/.zshrc
<span class="linenos">2</span>$ echo &#39;export SACAUX=${SACHOME}/aux&#39;&gt;&gt; ~/.zshrc
<span class="linenos">3</span>$ echo &#39;export PATH=${SACHOME}/bin:${PATH}&#39;&gt;&gt; ~/.zshrc
<span class="linenos">4</span>$ echo &#39;export SAC_DISPLAY_COPYRIGHT=1&#39;&gt;&gt; ~/.zshrc
<span class="linenos">5</span>$ echo &#39;export SAC_PPK_LARGE_CROSSHAIRS=1&#39;&gt;&gt; ~/.zshrc
<span class="linenos">6</span>$ echo &#39;export SAC_USE_DATABASE=0&#39;&gt;&gt; ~/.zshrc
<span class="linenos">7</span>$ source ~/.zshrc
</pre></div>
</div>
<p><em>4. Run sac</em></p>
<p>Type <code class="file docutils literal notranslate"><span class="pre">sac</span></code> in the terminal, there will be version information if installation is succeeded</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ sac
<span class="linenos">2</span> SEISMIC ANALYSIS CODE [11/11/2    3 (Version 1    .6a)]
<span class="linenos">3</span> Copyright 1995 Regents of the University of California
<span class="linenos">4</span>
<span class="linenos">5</span>SAC&gt;
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="gcap3d">
<h3>2.3 gCAP3D<a class="headerlink" href="#gcap3d" title="Permalink to this heading">¬∂</a></h3>
<p>gCAP is a method for inversion of focal mechanism solutions developed by Prof. Lupei Zhu. The source code of gCAP could be found in His <a class="reference external" href="http://www.eas.slu.edu/People/LZhu/downloads/">Home page</a>.</p>
<p>The code is now open source. The installation of gCAP could be found on <a class="reference external" href="https://blog.seisman.info/gcap-install/">seisman website</a>.</p>
<p>Here I integrated the file in the website and gave the modified package file for you <a class="reference download internal" download="" href="../_downloads/bc830920b2fdd413b5e762078bc9fcb4/gCAP3D.1.0.Cuseistut.tar"><code class="xref download docutils literal notranslate"><span class="pre">download</span></code></a>.</p>
<p><em>1. Download the file and unzip</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>## Download
<span class="linenos">2</span>## Unizp
<span class="linenos">3</span>$ tar -xvf gCAP3D.1.0.Cuseistut.tar
</pre></div>
</div>
<p><em>2. Download supplementary file and unzip</em></p>
<p>Refer to the seisman website above to download gcap_utils.tar.gz, unzip and put all files into the gCAP3D directory.</p>
<p><em>3. Install binary packages</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>## Move to installation position
<span class="linenos">2</span>$ sudo mv gCAP3D ~/Src
<span class="linenos">3</span>## change dir to gCAP3D
<span class="linenos">4</span>$ cd ~/Src/gCAP3D
<span class="linenos">5</span>## compilation
<span class="linenos">6</span>$ make clean
<span class="linenos">7</span>$ make
</pre></div>
</div>
<p><em>4. Configuration variable</em></p>
<p>Add the environment variables and SAC global variables in <code class="file docutils literal notranslate"><span class="pre">~/.bashrc</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ echo &#39;export PATH=~/Src/gcap:${PATH}&#39;&gt;&gt; ~/.bashrc
<span class="linenos">2</span>$ source ~/.bashrc
</pre></div>
</div>
<p><em>5. Modify directory</em></p>
<p>Open <code class="file docutils literal notranslate"><span class="pre">cap3D.pl</span></code>, change the directory on Line 17 from ‚Äò~/Src/gCAP3D/cap_plt.pl‚Äô to ‚Äò{your home directory}/Src/gCAP3D/cap_plt.pl‚Äô</p>
<p><em>6. Run gCAP3D</em></p>
<p>Type <code class="file docutils literal notranslate"><span class="pre">cap3D.pl</span></code> in the terminal, there will be version information if installation is succeeded</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ gCAP3D.pl
<span class="linenos">2</span>  ===== CAP seismic source tensor inversion using seismic waveforms ====
<span class="linenos">3</span>  Ref: Zhu and Helmberger, 1996, BSSA 86, 1645-1641.
<span class="linenos">4</span>  Zhu and Ben-Zion, 2    3, GJI, submitted.
<span class="linenos">5</span>  ...
</pre></div>
</div>
</section>
</section>
<section id="data-processing">
<h2>3 Data processing<a class="headerlink" href="#data-processing" title="Permalink to this heading">¬∂</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The steps of focal mechanism inversion using gCAP3D</p>
<ol class="arabic simple">
<li><p>Calculating the Green‚Äôs function</p></li>
<li><p>Remove the instrument response (PZ or RESP file) to get the real ground motion (requiring response files; find the details in <a class="reference external" href="https://seisman.github.io/SAC_Docs_zh/">sac manual</a>).</p></li>
</ol>
<ol class="arabic simple" start="3">
<li><p>Rotate the NEZ components to RTZ direction (ps, remember to remove the original NEZ data in the event folder). An introduction to these two coordinate systems can be found at <a class="reference external" href="http://seisman.info/coordinate-systems-in-seismology.html">this web</a></p></li>
</ol>
<ol class="arabic simple" start="4">
<li><p>Transform the data into the unit of cm/s by multiplying <code class="file docutils literal notranslate"><span class="pre">1e-7</span></code> (default unit in SAC data is <code class="file docutils literal notranslate"><span class="pre">nm</span></code>), which is the default unit in CAP.</p></li>
<li><p>Set the onset time of the event as the reference time (the zero point in the time series). Find the details in sac manual.</p></li>
<li><p>Pick the p arrival time and write the time in t1 marker, (for the noisy data, band pass filter can be applied to pick the p arrival more    accurately.) Remember that the bandpass filtered data should NOT be saved in the folder. All the sac file in the folder will be used in    waveform inversion.</p></li>
<li><p>Remember to remove the waveform data from the folder whose P arrival is too dim to be seen.</p></li>
<li><p>Resample the data to Œîùë° that the same as the Green‚Äôs function</p></li>
<li><p>Set up the ‚Äúinfo.eve‚Äù file under each event folder. It is a five-column file, of which the format is: ‚Äúo-marker evla evlo evdp mag‚Äù.</p></li>
<li><p>To run CAP:</p>
<ol class="arabic simple">
<li><p>Input command: make ${event_name}/weight.dat; and then write the p arrival time ‚Äì t1 into the eighth column of ‚Äúweight.dat‚Äù;</p></li>
<li><p>Input command: make ${event_name}/mt.best to start the waveform inversion process.</p></li>
</ol>
</li>
<li><p>check the uncertainty</p></li>
</ol>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the unit of displacement data obtained by transferring the PZ file is <code class="file docutils literal notranslate"><span class="pre">m</span></code>; the default unit of SAC is  <code class="file docutils literal notranslate"><span class="pre">nm</span></code>, so it must be multiplied by  <code class="file docutils literal notranslate"><span class="pre">1e9</span></code> to convert to the default unit of SAC.</p>
</div>
<section id="green-s-function-calculation">
<h3>3.1 Green‚Äôs function calculation<a class="headerlink" href="#green-s-function-calculation" title="Permalink to this heading">¬∂</a></h3>
<p>The first step of runing gCAP is building a Grenn‚Äôs function library by using fk package. An velocity model file (GD.vel) is need for the calculation. <a class="reference download internal" download="" href="../_downloads/e841bd1c617bf4c47d3bb0f6d1528e79/hn"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a> is the velocity model used in this tutorial. The default setting of <code class="file docutils literal notranslate"><span class="pre">gCAP</span></code> puts the Green‚Äôs function library under <code class="file docutils literal notranslate"><span class="pre">~/data/models/Glib</span></code></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There are two types of velocity model that could be used in fk, with the third column is the Vs or the vp/vs ratio.   <code class="file docutils literal notranslate"><span class="pre">-Kmodel/depth/k</span></code>, should be used while the 3rd column is vp/vs ratio (vp). The -S parameter controls the source type. <code class="file docutils literal notranslate"><span class="pre">-S</span></code>: 0=explosion; 1=single force; 2=double couple (2).</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>## mkdir the Green&#39;s function library directory
<span class="linenos"> 2</span>$ mkdir ~/data
<span class="linenos"> 3</span>$ mkdir ~/data/models
<span class="linenos"> 4</span>$ mkdir ~/data/models/Glib
<span class="linenos"> 5</span>## move to Green&#39;s function library directory
<span class="linenos"> 6</span>$ cd ~/data/models/Glib
<span class="linenos"> 7</span>## build a directory for velocity model GD
<span class="linenos"> 8</span>$ mkdir GD
<span class="linenos"> 9</span>$ cd GD
<span class="linenos">10</span>## cp GD.vel to GD directoty, please replace the &#39;/path/to/fk/GD.vel&#39; to the real path in your system
<span class="linenos">11</span>$ cp /path/to/fk/GD.vel .
<span class="linenos">12</span>## calculate the Green&#39;s function library using fk
<span class="linenos">13</span>$ fk.pl -MGD.vel/15/k -N512/0.2 -S2 05 10 15 20 25 30 35 40 45 50 55 60 65 70 75 80 85 90 95 100 105 110 115 120 125 130 135 140 145 150 155 160 165 170 175 180 185 190 195 200 205 210 215 220 225 230 235 240 245 250 255 260 265 270 275 280 285 290 295 300 305 310 315 320 325 330 335 340 345 350 355 360 365 370 375 380 385 390 395 400 405 410 415
<span class="linenos">14</span>$ fk.pl -MGD.vel/15/k -N512/0.2 -S0 05 10 15 20 25 30 35 40 45 50 55 60 65 70 75 80 85 90 95 100 105 110 115 120 125 130 135 140 145 150 155 160 165 170 175 180 185 190 195 200 205 210 215 220 225 230 235 240 245 250 255 260 265 270 275 280 285 290 295 300 305 310 315 320 325 330 335 340 345 350 355 360 365 370 375 380 385 390 395 400 405 410 415
</pre></div>
</div>
</section>
<section id="sac-file-preparation">
<h3>3.2 Sac file preparation<a class="headerlink" href="#sac-file-preparation" title="Permalink to this heading">¬∂</a></h3>
<p>The sac file preparation could be done by using <code class="file docutils literal notranslate"><span class="pre">SAC</span></code> software or other softwares, such as the <code class="file docutils literal notranslate"><span class="pre">Obspy</span></code>. Here we briefly introduce the steps while using <code class="file docutils literal notranslate"><span class="pre">SAC</span></code>. The details of commands used in this chapater could be found in the <a class="reference external" href="https://seisman.github.io/SAC_Docs_zh/">sac manual</a>.</p>
<p><em>1. Remove the instrument response</em></p>
<p>&gt; Use PZ file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>## Merge PZ files of all stations into the same file
<span class="linenos"> 2</span>$ cat SAC_PZs_* &gt;&gt; SAC.PZs
<span class="linenos"> 3</span>## remove the instrument response by command: transfer
<span class="linenos"> 4</span>$ sac
<span class="linenos"> 5</span>SAC&gt; r *.SAC
<span class="linenos"> 6</span>## When going to the instrument response, try to choose a wider frequency band
<span class="linenos"> 7</span>SAC&gt; trans from pol s SAC.PZs to none freq 0.004 0.007 40 45
<span class="linenos"> 8</span>SAC&gt; mul 1.0e9
<span class="linenos"> 9</span>SAC&gt; w over
<span class="linenos">10</span>SAC&gt; q
</pre></div>
</div>
<p>&gt; Use RESP file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>## Merge RESP files of all stations into the same file
<span class="linenos">2</span>$ cat RESP.*.*.*.* &gt;&gt; RESP.ALL
<span class="linenos">3</span>## remove the instrument response by command: transfer
<span class="linenos">4</span>$ sac
<span class="linenos">5</span>SAC&gt; r *.SAC
<span class="linenos">6</span>## When going to the instrument response, try to choose a wider frequency band
<span class="linenos">7</span>SAC&gt; trans from evalresp fname RESP.ALL to none freq 0.004 0.007 40 45
<span class="linenos">8</span>SAC&gt; w over
<span class="linenos">9</span>SAC&gt; q
</pre></div>
</div>
<p><em>2. Rotate the NEZ components to RTZ direction</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>$ sac
<span class="linenos"> 2</span>SAC&gt; r ./example.n ./example.e
<span class="linenos"> 3</span>SAC&gt; lh cmpinc cmpaz
<span class="linenos"> 4</span>    FILE: ./example.n - 1
<span class="linenos"> 5</span>    --------------
<span class="linenos"> 6</span>    cmpinc = 9.000000e+
<span class="linenos"> 7</span>    cmpaz = 0.000000e+00
<span class="linenos"> 8</span>    FILE: ./example.e - 2
<span class="linenos"> 9</span>    --------------
<span class="linenos">10</span>    cmpinc = 9.000000e+
<span class="linenos">11</span>    cmpaz = 9.000000e+
<span class="linenos">12</span>## Rotate to Great Circle Path
<span class="linenos">13</span>SAC&gt; rotate to gcp
<span class="linenos">14</span>SAC&gt; lh cmpinc cmpaz
<span class="linenos">15</span>    FILE: ./example.n - 1
<span class="linenos">16</span>    --------------
<span class="linenos">17</span>    cmpinc = 9.000000e+
<span class="linenos">18</span>    cmpaz = 2.440466e+
<span class="linenos">19</span>    FILE: ./example.e - 2
<span class="linenos">20</span>    --------------
<span class="linenos">21</span>    cmpinc = 9.000000e+
<span class="linenos">22</span>    cmpaz = 1.144047e+02
<span class="linenos">23</span>## Save as R component and T component
<span class="linenos">24</span>SAC&gt; w example.r example.t
<span class="linenos">25</span>SAC&gt; q
</pre></div>
</div>
<p><em>3. Resampling the sac file</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">SAC</span><span class="o">&gt;</span> <span class="n">r</span> <span class="n">example</span><span class="o">.</span><span class="n">SAC</span>
<span class="linenos"> 2</span><span class="n">SAC</span><span class="o">&gt;</span> <span class="n">lh</span> <span class="n">delta</span> <span class="n">npts</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>    <span class="n">delta</span> <span class="o">=</span> <span class="mf">1.000000e-02</span>
<span class="linenos"> 5</span>    <span class="n">npts</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="linenos"> 6</span><span class="c1">## change the sampling rate to 0.005</span>
<span class="linenos"> 7</span><span class="n">SAC</span><span class="o">&gt;</span> <span class="n">interp</span> <span class="n">delta</span> <span class="mf">0.005</span>
<span class="linenos"> 8</span><span class="n">SAC</span><span class="o">&gt;</span> <span class="n">lh</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>    <span class="n">delta</span> <span class="o">=</span> <span class="mf">5.000000e-03</span>
<span class="linenos">11</span>    <span class="n">npts</span> <span class="o">=</span> <span class="mi">1999</span>
<span class="linenos">12</span><span class="n">SAC</span><span class="o">&gt;</span> <span class="n">q</span>
</pre></div>
</div>
<p><em>4. Mark the P and S arrivels</em></p>
<p>The arrivels could be labeled by using SAC by using ppk command as well. please refer to the <a class="reference external" href="https://seisman.github.io/SAC_Docs_zh/">sac manual</a>).</p>
<blockquote>
<div></div></blockquote>
</section>
<section id="focal-mechanism-inversion">
<h3>3.3 Focal mechanism inversion<a class="headerlink" href="#focal-mechanism-inversion" title="Permalink to this heading">¬∂</a></h3>
<p>After the sac files prepared, we could start to run the gCAP inversion. here we provided the SAC files of the 01/04/2020 Offshore Pearl River Delta earthquake [CHEN et.al., 2021] for you <a class="reference download internal" download="" href="../_downloads/824e5ef0310e2d37b9c73cf029b12b9a/01-04-2020-earthquake.rar"><code class="xref download docutils literal notranslate"><span class="pre">download</span></code></a>. Please download it the unzip it and them change your current directory to <code class="file docutils literal notranslate"><span class="pre">01-04-2020-earthquake</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ cd ./01-04-2020-earthquake
</pre></div>
</div>
<p><em>1. Make weight.dat file</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>#### please copy the following command to a bash script and then run the bash file.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>#!/bin/bash
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>dir=20200104225537
<span class="linenos"> 6</span>cd $dir
<span class="linenos"> 7</span>pwd
<span class="linenos"> 8</span>rm temp
<span class="linenos"> 9</span>for sac in *z
<span class="linenos">10</span>    do
<span class="linenos">11</span>    sta=$(echo $sac | awk -F &quot;.&quot; &#39;{print $1}&#39;)
<span class="linenos">12</span>    dist1=$(saclst dist f $sac | awk &#39;{print $2}&#39;)
<span class="linenos">13</span>    dist_c=$(echo $dist1 | awk &#39;{printf (&quot;%d\n&quot;,$1/5+0.5)}&#39;)
<span class="linenos">14</span>    dist=$(echo &quot;&quot;$dist_c&quot;*5&quot; |bc)
<span class="linenos">15</span>    P=$(saclst a f $sac | awk &#39;{print $2}&#39;)
<span class="linenos">16</span>    #echo $dist1 $dist
<span class="linenos">17</span>    printf &quot;%-10s %03d %-1s %-1s %-1s %-1s %-1s %3.1f %-1s\n&quot;  $sta $dist &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; $P &quot;0&quot; &gt;&gt; temp
<span class="linenos">18</span>done
<span class="linenos">19</span>cat temp | sort -n -k2 &gt; weight.dat
</pre></div>
</div>
<p>The generated file as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>$ cat weight.dat
<span class="linenos"> 2</span>$ HKPS       035 1 1 1 1 1 7.2 0
<span class="linenos"> 3</span>  ZHH        035 1 1 1 1 1 7.2 0
<span class="linenos"> 4</span>  HKOC       040 1 1 1 1 1 8.3 0
<span class="linenos"> 5</span>  SZN        060 1 1 1 1 1 10.3 0
<span class="linenos"> 6</span>  ZHS        065 1 1 1 1 1 11.8 0
<span class="linenos"> 7</span>  TIS        100 1 1 1 1 1 18.0 0
<span class="linenos"> 8</span>  XNH        100 1 1 1 1 1 17.1 0
<span class="linenos"> 9</span>  SCD        115 1 1 1 1 1 19.4 0
<span class="linenos">10</span>  HUZ        140 1 1 1 1 1 22.7 0
<span class="linenos">11</span>  HUD        170 1 1 1 1 1 26.8 0
<span class="linenos">12</span>  ZHQ        180 1 1 1 1 1 27.9 0
<span class="linenos">13</span>  HYJ        195 1 1 1 1 1 30.1 0
<span class="linenos">14</span>  LTK        195 1 1 1 1 1 29.6 0
<span class="linenos">15</span>  XFJ        200 1 1 1 1 1 29.8 0
<span class="linenos">16</span>  YGJ        200 1 1 1 1 1 30.0 0
<span class="linenos">17</span>  XIG        205 1 1 1 1 1 31.1 0
<span class="linenos">18</span>  ZIJ        225 1 1 1 1 1 32.9 0
<span class="linenos">19</span>  YND        230 1 1 1 1 1 33.5 0
<span class="linenos">20</span>  LIP        260 1 1 1 1 1 37.1 0
<span class="linenos">21</span>  HUJ        270 1 1 1 1 1 38.9 0
<span class="linenos">22</span>  SHG        310 1 1 1 1 1 42.9 0
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The weight file controls the components of each station that will be used in the inversion. if the number is set as 0, the component will be excluded in the inversion.</p>
<p>Station       Azimuth        Pz         Pr         Sz         Sr         Sh        P-arrival time</p>
</div>
<p><em>2. Run the inversion</em></p>
<p>After generate the weight.dat file, please change your working direcroty to 01-04-2020-earthquake</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ cd ../
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>#### please copy the following command to a bash script and then run the bash file.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>#!/bib/bash
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>## set the velocity model
<span class="linenos"> 6</span>model=hn
<span class="linenos"> 7</span>## set the target event
<span class="linenos"> 8</span>event=20200104225537
<span class="linenos"> 9</span>## set the event magnitude
<span class="linenos">10</span>mag=3.5
<span class="linenos">11</span>
<span class="linenos">12</span>## loop the inversion for variou focal depth
<span class="linenos">13</span>for h in 08 09 10 11 12 13 14 15 100
<span class="linenos">14</span>do
<span class="linenos">15</span>    cap3D.pl -H0.01 -P180000 -S2/5/0 -T20/50 -D1/1/0.5 -C0.05/0.2/0.03/0.1 -W1 -J0/0.01/0/0.01 -X10 -M$model&quot;_&quot;$h  $event;
<span class="linenos">16</span>done
<span class="linenos">17</span>
<span class="linenos">18</span>## obtained the inversion result and plot figure
<span class="linenos">19</span>grep -h Event $event/$model_*.out &gt; junk_$model.out
<span class="linenos">20</span>./depth.pl junk_$model.out $event &gt; junk_$model.ps
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The key paramters of cap3D.pl are as following:</p>
<p>-H the delta (1/samping rate) of the date</p>
<dl class="simple">
<dt>-S max. time shifts in sec for Pnl and surface waves (1/) and tie between SH shift and SV shift:</dt><dd><p>tie=0          shift SV and SH independently,
tie=0.5        force the same shift for SH and SV (0.5).</p>
</dd>
</dl>
<p>-T max. time window lengths for Pnl and surface waves (35/70).</p>
<p>-C filters for Pnl and surface waves, specified by the corner frequencies of the band-pass filter. (0.02/0.2/0.02/0.1).</p>
<p>-W use displacement for inversion; 1=&gt; data in velocity; 2=&gt; data in disp (0).</p>
</div>
<p>The inversion should be conducted multiple times with various parameters to achieve robust inversion result.</p>
<a class="reference internal image-reference" href="../_images/inversion-result.jpg"><img alt="../_images/inversion-result.jpg" src="../_images/inversion-result.jpg" style="width: 50%;" /></a>
<a class="reference internal image-reference" href="../_images/inversion-depth.jpg"><img alt="../_images/inversion-depth.jpg" src="../_images/inversion-depth.jpg" style="width: 50%;" /></a>
</section>
<section id="uncertainty-analysis">
<h3>3.3 Uncertainty analysis<a class="headerlink" href="#uncertainty-analysis" title="Permalink to this heading">¬∂</a></h3>
<p>The uncertainty of the CAP inversion result can be estimated using a bootstrapping inversion method (Tichelaar and Ruff, 1989), in which stations were randomly selected from the station pool (21 stations
in total), allowing multiple sampling.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>#### please copy the following command to a bash script and then run the bash file.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>#!/bib/bash
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>model=hn
<span class="linenos"> 6</span>event=20200104225537
<span class="linenos"> 7</span>mag=3.5
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>##making bootstrapping inversiong weiht.dat file by randomly choose stations from original weight.dat file. Extra weight were added for repeated stations.
<span class="linenos">10</span>
<span class="linenos">11</span>ori=./weight1.dat
<span class="linenos">12</span>
<span class="linenos">13</span>for i in `seq 1 1000`
<span class="linenos">14</span>do
<span class="linenos">15</span>echo &quot;---------------$i-----------------&quot;
<span class="linenos">16</span>cd 20200104225537
<span class="linenos">17</span>out=weight_test.dat
<span class="linenos">18</span>rm $out
<span class="linenos">19</span>rm temp
<span class="linenos">20</span>for j in `seq 1 21`
<span class="linenos">21</span>do
<span class="linenos">22</span>    shuf -n1 $ori &gt;&gt; temp
<span class="linenos">23</span>done
<span class="linenos">24</span>    cat temp |sort -n -k2 | uniq &gt; temp2
<span class="linenos">25</span>    ## give weight for each station according to the times it was sampled
<span class="linenos">26</span>    for sta in `awk &#39;{print $1}&#39; temp2`
<span class="linenos">27</span>    do
<span class="linenos">28</span>        count=$(grep $sta temp | wc -l)
<span class="linenos">29</span>        grep $sta temp |awk &#39;NR==1 {print $1,$2,&#39;$count&#39;*$3,&#39;$count&#39;*$4,&#39;$count&#39;*$5,&#39;$count&#39;*$6,&#39;$count&#39;*$7,$8,$9}&#39; &gt;&gt; $out
<span class="linenos">30</span>
<span class="linenos">31</span>    done
<span class="linenos">32</span>
<span class="linenos">33</span>    echo $out
<span class="linenos">34</span>    cd ..
<span class="linenos">35</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    for h in 08 09 10 11 12 13 14 15;
<span class="linenos">38</span>    do
<span class="linenos">39</span>        cap3D.pl -H0.01 -P180000  -S2/5/0 -T20/50 -D1/1/0.5 -C0.05/0.2/0.03/0.1 -W1 -X10 -M$model&quot;_&quot;$h -Zweight_test.dat -R0/360/0/90/-90/90 $event;
<span class="linenos">40</span>
<span class="linenos">41</span>    done
<span class="linenos">42</span>
<span class="linenos">43</span>
<span class="linenos">44</span>    grep -h Event $event/&quot;$model&quot;_*.out &gt; junk_&quot;$model&quot;_&quot;$i&quot;.out
<span class="linenos">45</span>    ./depth.pl junk_&quot;$model&quot;_&quot;$i&quot;.out $event &gt; junk_&quot;$model&quot;_&quot;$i&quot;.ps
<span class="linenos">46</span>
<span class="linenos">47</span>done
</pre></div>
</div>
<p>&gt; plot bootstrapping results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>#### please copy the following command to a bash script and then run the bash file.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>#!/bin/bash
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>out_ps=focal.ps
<span class="linenos"> 6</span>file=hn_10.lst
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    cat *.out &gt; $file
<span class="linenos"> 9</span>gmt psbasemap -JM18c -R0/18/0/18 -Bxa2f1 -Bya2f1 -K &gt; $out_ps
<span class="linenos">10</span>rm temp ./SDR.txt
<span class="linenos">11</span>
<span class="linenos">12</span>## plot the inversion results of each bootstrapping inversion
<span class="linenos">13</span>while read line
<span class="linenos">14</span>do
<span class="linenos">15</span>    echo $line
<span class="linenos">16</span>    strike=$(echo $line |awk &#39;{print $6}&#39;)
<span class="linenos">17</span>    dip=$(echo $line |awk &#39;{print $7}&#39;)
<span class="linenos">18</span>    if [ $dip -eq 90 ]
<span class="linenos">19</span>    then
<span class="linenos">20</span>        dip=89.99
<span class="linenos">21</span>    else
<span class="linenos">22</span>        dip=$dip
<span class="linenos">23</span>    fi
<span class="linenos">24</span>    rake=$(echo $line |awk &#39;{print $8}&#39;)
<span class="linenos">25</span>    echo $strike $dip $rake &gt;&gt; ./SDR.txt
<span class="linenos">26</span>    echo &quot;9 9 10 $strike $dip $rake 5 0 0&quot; &gt; temp
<span class="linenos">27</span>    gmt psmeca temp -J -R -Sa17c -Fa/0.1c/s -Fered -Fgblue -T0/0.01p,gray -L0.01p,black -K -O &gt;&gt; $out_ps
<span class="linenos">28</span>
<span class="linenos">29</span>done &lt; $file
<span class="linenos">30</span>
<span class="linenos">31</span>
<span class="linenos">32</span>## plot the initial inversion result
<span class="linenos">33</span>echo &quot;9 9 10 168 79 2 5 0 0&quot; &gt; temp
<span class="linenos">34</span>gmt psmeca temp -J -R -Sa17c -Fa/0.1c/s -Fered -Fgblue -T0/0.01p,red -L0.01p,black -K -O &gt;&gt; $out_ps
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/bootstrap.jpg"><img alt="../_images/bootstrap.jpg" src="../_images/bootstrap.jpg" style="width: 50%;" /></a>
<p>&gt; plot the histogram</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>#### please copy the following command to a bash script and then run the bash file.
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>    #!bin/bash
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>    file=hn_10.lst
<span class="linenos"> 6</span>    ps=hist_srtike_dip_rake.ps
<span class="linenos"> 7</span>    cat $file |awk &#39;{print $6}&#39; |gmt pshistogram -R160/180/0/50 -JX5c/10c -Z1 -Bxa5f1+l&quot;Strike(degree)&quot; -Bya10f2+l&quot;Frequency(%)&quot; -BWSne -L0.1p -Ggray -W1+b -K &gt; $ps
<span class="linenos"> 8</span>    cat $file |awk &#39;{print $7}&#39; |gmt pshistogram -R70/90/0/50 -JX5c/10c -Z1 -Bxa5f1+l&quot;Dip(degree)&quot; -Bya10f2+l&quot;Frequency(%)&quot; -BWSne -L0.1p -Ggray -W1+b -K -O -X7c&gt;&gt; $ps
<span class="linenos"> 9</span>    cat $file |awk &#39;{print $8}&#39; |gmt pshistogram -R-10/10/0/50 -JX5c/10c -Z1 -Bxa5f1+l&quot;Rake(degree)&quot; -Bya10f2+l&quot;Frequency(%)&quot; -BWSne -L0.1p -Ggray -W1+b -K -O -X7c&gt;&gt; $ps
<span class="linenos">10</span>
<span class="linenos">11</span>    # plot sub-basemap
<span class="linenos">12</span>
<span class="linenos">13</span>    gmt set FONT_ANNOT_PRIMARY +16p
<span class="linenos">14</span>
<span class="linenos">15</span>    R=0/29.7/0/21
<span class="linenos">16</span>    J=x1/1
<span class="linenos">17</span>    B=a1g1
<span class="linenos">18</span>    #gmt set MAP_FRAME_TYPE=inside MAP_GRID_PEN_PRIMARY=0p,red,.
<span class="linenos">19</span>    #gmt psbasemap -R$R -J$J -B$B -BWSEN -K -O -Xf0c -Yf0c &gt;&gt; $ps
<span class="linenos">20</span>
<span class="linenos">21</span>    echo &quot;1.3 12.5 (a)&quot; |gmt pstext -R$R -J$J -Xf0c -Yf0c -K -O &gt;&gt; $ps
<span class="linenos">22</span>    echo &quot;8.3 12.5 (b)&quot; |gmt pstext -R$R -J$J -Xf0c -Yf0c -K -O &gt;&gt; $ps
<span class="linenos">23</span>    echo &quot;15.3 12.5 (c)&quot; |gmt pstext -R$R -J$J -Xf0c -Yf0c -K -O &gt;&gt; $ps
<span class="linenos">24</span>
<span class="linenos">25</span>    gmt ps2raster $ps -A -P -Tf
<span class="linenos">26</span>
<span class="linenos">27</span>    rm gmt.conf gmt.history
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/histogram.jpg"><img alt="../_images/histogram.jpg" src="../_images/histogram.jpg" style="width: 50%;" /></a>
<p>&gt; calculate the uncertaities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">cat</span> <span class="n">SDR</span><span class="o">.</span><span class="n">txt</span> <span class="o">|</span><span class="n">awk</span> <span class="s1">&#39;{print $1}&#39;</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{x[NR]=$0; s+=$0; n++} END{a=s/n; for (i in x){ss += (x[i]-a)^2} sd = sqrt(ss/n); print &quot;SD of strike = &quot;sd}&#39;</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">cat</span> <span class="n">SDR</span><span class="o">.</span><span class="n">txt</span> <span class="o">|</span><span class="n">awk</span> <span class="s1">&#39;{print $2}&#39;</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{x[NR]=$0; s+=$0; n++} END{a=s/n; for (i in x){ss += (x[i]-a)^2} sd = sqrt(ss/n); print &quot;SD of dip = &quot;sd}&#39;</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="n">cat</span> <span class="n">SDR</span><span class="o">.</span><span class="n">txt</span> <span class="o">|</span><span class="n">awk</span> <span class="s1">&#39;{print $3}&#39;</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{x[NR]=$0; s+=$0; n++} END{a=s/n; for (i in x){ss += (x[i]-a)^2} sd = sqrt(ss/n); print &quot;SD of rake = &quot;sd}&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">¬∂</a></h2>
<p>Zhu, L., &amp; Ben-Zion, Y. (2013). Parametrization of general seismic potency and moment tensors for source inversion of seismic waveform data. Geophysical Journal International, 194(2), 839-843.</p>
<p>Yang, H., Zhu, L., &amp; Chu, R. (2009). Fault-plane determination of the 18 April 2008 Mount Carmel, Illinois, earthquake by detecting and relocating aftershocks. Bulletin of the Seismological Society of America, 99(6), 3413-3420.</p>
<p>Chen, H., He, X., Yang, H., &amp; Zhang, J. (2021). Fault‚Äêplane determination of the 4 January 2020 offshore pearl river delta earthquake and its implication for seismic hazard assessment. Seismological Society of America, 92(3), 1913-1925.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../eqt/index.html" class="btn btn-neutral float-right" title="Earthquake Transformer Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../abs_loc/index.html" class="btn btn-neutral float-left" title="Earthquake Absolute Location" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021-2022, CUSeisTut team
      <span class="lastupdated">
        Last updated on 2022-11-23.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>