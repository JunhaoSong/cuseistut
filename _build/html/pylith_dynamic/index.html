<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dynamic Rupture Simulation &mdash; CUSeisTut</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Body Wave Tomography" href="../body_tomo/index.html" />
    <link rel="prev" title="Static Stress Change - PyLith" href="../pylith_static/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> CUSeisTut
          </a>
              <div class="version">
                0.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">CUSeisTut</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Entry level</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../unix/index.html">Unix commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GMT6-1/index.html">Generic Mapping Tools - Topographic Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GMT6-2/index.html">Generic Mapping Tools - Seismic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../obspy-1/index.html">Seismic data request via ObsPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../obspy-2/index.html">Seismic data process via ObsPy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Intermediate level</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sta_lta/index.html">Earthquake Detection STA/LTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../abs_loc/index.html">Earthquake Absolute Location</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced level</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../eqt/index.html">Earthquake Transformer Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dd_loc/index.html">Double-Difference Earthquake Relocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source_spectra/index.html">Spectral Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pylith_static/index.html">Static Stress Change - PyLith</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dynamic Rupture Simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#brief-introduction">Brief introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aim-of-this-module">Aim of this module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simple-3d-case-study-nepal">Simple 3D case study - Nepal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-structure-of-a-configuration-cfg-file">Basic structure of a configuration (.cfg) file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-structure-of-a-spatial-database-spatialdb-file">Basic structure of a spatial database (.spatialdb) file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-dynamic-simulation">Running the dynamic simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#visualizing-results">Visualizing results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-install-h5py">How to install h5py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../body_tomo/index.html">Body Wave Tomography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../surface_tomo/index.html">Surface Wave Tomography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ambient_tomo/index.html">Ambient noise cross correlation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">List of developers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/forms/d/e/1FAIpQLScSQIcOtANjTonJDhK4KYmoA6H2lUHou9Mqz1oFCHSTd5wxhQ/viewform?usp=sf_link">Give us feedback here</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CUSeisTut</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Dynamic Rupture Simulation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pylith_dynamic/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dynamic-rupture-simulation">
<h1>Dynamic Rupture Simulation<a class="headerlink" href="#dynamic-rupture-simulation" title="Permalink to this headline"></a></h1>
<section id="brief-introduction">
<h2>Brief introduction<a class="headerlink" href="#brief-introduction" title="Permalink to this headline"></a></h2>
<p>Dynamic modeling of earthquakes provides important insights in the physics of earthquake rupture processes. For example, earthquake initiation, propagation, arrest, afterslip, locking, and interseismic stress accumulation can be solved. In particular, dynamic earthquake rupture codes compute the physical earthquake behaviors over short time scales, producing possible earthquake size, fault slip amount, ground motion, and crustal deformation, which are crucial for risk assessment.</p>
<p>Currently, dynamic rupture simulations are actively used in seismology research for reconstructing well-recorded earthquakes as well as investigating the complex factors controlling earthquakes, such as fault geometry, fault frictional properties, and initial stresses.</p>
<section id="aim-of-this-module">
<h3>Aim of this module<a class="headerlink" href="#aim-of-this-module" title="Permalink to this headline"></a></h3>
<p>There are different dynamic earthquake rupture codes for a range of code types, including finite element, discontinuous Galerkin finite element, and spectral element methods. In this module, we will focus on <strong>PyLith</strong> which is a finite-element code.</p>
<p>In this tutorial, we are going to conduct a dynamic rupture simulation using a simple 3D example. As illustrated in the below figure, the inputs of PyLith requires the fault geometry and rock properties, initial stresses, and fault friction.</p>
<a class="reference internal image-reference" href="../_images/dynamic_requirements.png"><img alt="../_images/dynamic_requirements.png" src="../_images/dynamic_requirements.png" style="width: 80%;" /></a>
<p>figure 1. Key ingredients of a dynamic (spontaneous) earthquake rupture simulation (Harris et al. 2018)</p>
<p>The fault geometry is described by the given mesh. In this example, we will assume the materials to be elastic. For the rock properties, we will use a spatial database to specify a simple depth-dependent material properties, including density, compressional wave velocity (vp), and shear wave velocity (vs).</p>
<a class="reference internal image-reference" href="../_images/mesh.png"><img alt="../_images/mesh.png" src="../_images/mesh.png" style="width: 80%;" /></a>
<p>figure 2. 3D mesh given in this tutorial with dimensions in kilometers</p>
<p>There are different fault frictional laws. Here we are going to introduce the linear slip-weakening law, which is described by yield strength/stress, initial stress, sliding-friction/dynamic stress, and critical slip distance dc. Yield strength/stress is the maximum stress level that can be applied before the fault slips. Sliding friction is the background stress level. The difference between the initial stress and the yield strength is known as the strength excess. A fault has to overcome this strength excess to allow ruptures.</p>
<a class="reference internal image-reference" href="../_images/linear_slip_weakening.png"><img alt="../_images/linear_slip_weakening.png" src="../_images/linear_slip_weakening.png" style="width: 80%;" /></a>
<p>figure 3. Schematic diagram of linear slip-weakening model</p>
<p>We can also take a look at the equation for the traction on the fault plane using linear slip-weakening law. When the fault slip (d) is within the critical slip distance (dc), the stress level (Tf) decreases linearly from the static (Ts) to dynamic level (Td). When the fault slip exceeds the critical slip distance, the stress level is the same as the sliding friction.</p>
<a class="reference internal image-reference" href="../_images/linear_slip_weakening_eq.png"><img alt="../_images/linear_slip_weakening_eq.png" src="../_images/linear_slip_weakening_eq.png" style="width: 50%;" /></a>
<p>In <strong>PyLith</strong>, we would use friction coefficients to specify the frictional properties of the fault. Yield strength is the product of static coefficient and fault normal traction while sliding friction is the product of dynamic coefficient and fault normal traction. In this example, we are using homogeneous initial stresses and dynamic stress on fault. To initiate the rupture, we lower the yield stress below the initial stress level within a circular zone. You can also visualize the yield strength, initial stress, and dynamic stress as the following plot.</p>
<a class="reference internal image-reference" href="../_images/nucleation.png"><img alt="../_images/nucleation.png" src="../_images/nucleation.png" style="width: 70%;" /></a>
<p>figure 4. Plot of the stresses on the fault in our example</p>
<p>Now, you already have a general picture of our problem in this tutorial. In the following, you will learn:</p>
<div class="line-block">
<div class="line">1. the input parameters</div>
<div class="line">2. initiating a rupture simulation</div>
<div class="line">3. visualizing the output</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="line-block">
<div class="line">Here we assume that you have already installed and initialized PyLith. If not, you may refer to <a class="reference external" href="https://cuseistut.readthedocs.io/en/latest/pylith_static/index.html">our module on static simulations</a> .</div>
</div>
</div>
</section>
</section>
<section id="simple-3d-case-study-nepal">
<h2>Simple 3D case study - Nepal<a class="headerlink" href="#simple-3d-case-study-nepal" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">1. Download the tutorial package <a class="reference download internal" download="" href="../_downloads/b9d8c98e0d2dcc8eee34c26ce7abb412/pylith_dynamic.tar.gz"><code class="xref download docutils literal notranslate"><span class="pre">pylith_dynamic.tar.gz</span></code></a> and move it to your working directory</div>
<div class="line">2. Run this command to decompress the package</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tar xvf pylith_dynamic.tar.gz
</pre></div>
</div>
<div class="line-block">
<div class="line">3. <code class="docutils literal notranslate"><span class="pre">ls</span></code> different folders in the directory to familiarize yourself with the different files required for a dynamic simulation</div>
</div>
<p>For running the dynamic simulation, you will need configuration files (.cfg) that specifies the problem, mesh (.exo) where the simulation takes place, spatial database files (.spatialdb) that describes the variables in space. Here we have three spatial database files - material property, frictional property, and traction. Since the mesh generating softwares are commercial, only the configuration and spatial database files will be illustrated in the following.</p>
<section id="basic-structure-of-a-configuration-cfg-file">
<h3>Basic structure of a configuration (.cfg) file<a class="headerlink" href="#basic-structure-of-a-configuration-cfg-file" title="Permalink to this headline"></a></h3>
<p>Now, let’s take a took at the <strong>dynamic_rupture_model.cfg</strong> under the <strong>pylith_dynamic</strong> directory. For a simulation in PyLith, you would need a <strong>configuration file (.cfg)</strong> which specifies the basic parameters of the simulation. Many of the commands are the same with those used in a <a class="reference external" href="https://cuseistut.readthedocs.io/en/latest/pylith_static/index.html">static simulation</a> so the following will only introduce some parameters specified for dynamic simulations.</p>
<div class="line-block">
<div class="line"><strong>1. Problem</strong></div>
</div>
<p>simulations.
<code class="docutils literal notranslate"><span class="pre">normalizer</span></code> used to nondimensionalize the equations.
<code class="docutils literal notranslate"><span class="pre">shear_wave_speed</span></code> specifies the shear wave speed used to nondimensionalize length and pressure (default is 3.0 km/s).
<code class="docutils literal notranslate"><span class="pre">mass_density</span></code> specifies the mass density to nondimensionalize density and pressure (default is 3.0e+3 kg/m3).
<code class="docutils literal notranslate"><span class="pre">wave_period</span></code> specifies the period of seismic waves used to nondimensionalize time (default is 1.0 s).</p>
<div class="line-block">
<div class="line"><strong>2. Boundary condition</strong></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pylith.bc.AbsorbingDampers</span></code> specifies absorbing boundary condition. Note that this function does not perfectly absorb all incident waves. Please refer to the <a class="reference download internal" download="" href="../_downloads/cfabbbfae9e8c659ca211702f4bf23e5/pylith-2.2.2_manual.pdf"><code class="xref download docutils literal notranslate"><span class="pre">manual</span></code></a> for more details.</p>
<div class="line-block">
<div class="line"><strong>3. Faults</strong></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pylith.faults.FaultCohesiveDyn</span></code> specifies dynamic fault interface.
<code class="docutils literal notranslate"><span class="pre">pylith.friction.SlipWeakening</span></code> specifies linear slip-weakening friction fault constitutive model. There are also other friction models, e.g. rate and state friction, and linear time-weakening friction model.
<code class="docutils literal notranslate"><span class="pre">friction.db_properties.idhandler.filename</span></code> specifies the filename for the friction parameters.
<code class="docutils literal notranslate"><span class="pre">traction_perturbation</span></code> specifies initial tractions on fault surface.
<code class="docutils literal notranslate"><span class="pre">db_initial.data</span></code> specifies the left lateral shear traction, updip shear traction, and normal traction (tension is positive, compression is negative) to be 0 MPa, 55 MPa, -100 MPa.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="line-block">
<div class="line">The above only documents the some parameters that we may change specified to our static simulation. Note that under this directory, there is also another configuration file <strong>pylithapp.cfg</strong>. <strong>pylithapp.cfg</strong> is not a self-contained simulation configuration file but it specifies the general parameters common to the simulations under this directory. This file is necessary for running our simulation.</div>
<div class="line">For more functions and information, please browse through the <a class="reference download internal" download="" href="../_downloads/cfabbbfae9e8c659ca211702f4bf23e5/pylith-2.2.2_manual.pdf"><code class="xref download docutils literal notranslate"><span class="pre">PyLith</span> <span class="pre">manual</span></code></a>.</div>
</div>
</div>
</section>
<section id="basic-structure-of-a-spatial-database-spatialdb-file">
<h3>Basic structure of a spatial database (.spatialdb) file<a class="headerlink" href="#basic-structure-of-a-spatial-database-spatialdb-file" title="Permalink to this headline"></a></h3>
<p>After knowing what the configuration files do, let’s learn about the spatial database files under the spatialdb directory. The structure and parameter settings of the spatial database files used here are basically the same with those introduced in the <a class="reference external" href="https://cuseistut.readthedocs.io/en/latest/pylith_static/index.html">static simulation tutorial</a> but their contents are different, thus <code class="docutils literal notranslate"><span class="pre">value-names</span></code>, <code class="docutils literal notranslate"><span class="pre">value-units</span></code>, and <code class="docutils literal notranslate"><span class="pre">data-dim</span></code> are changed.</p>
<div class="line-block">
<div class="line"><strong>1. friction.spatialdb</strong></div>
</div>
<p>This spatial database file specifies the parameters required in the frictional law. As we are using the linear slip-weakening friction model, the static coefficient, dynamic coefficient, critical slip distance, and cohesive stress are specified in this file.</p>
<div class="line-block">
<div class="line"><strong>2. mat_concrust_1D.spatialdb</strong></div>
</div>
<p>This spatial database file specifies the material properties. Here we prescribe depth dependent material properties - density, compressional wave velocity vp, and shear wave velocity vs.</p>
</section>
<section id="running-the-dynamic-simulation">
<h3>Running the dynamic simulation<a class="headerlink" href="#running-the-dynamic-simulation" title="Permalink to this headline"></a></h3>
<p>Now that we have a general picture of the files required for our simulation, let’s run the simulation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd your_working_directory/pylith_dynamic/
$ pylith dynamic_rupture_model.cfg
</pre></div>
</div>
<p>Now the current timesteps are displayed in the terminal, and you can wait for the simulation to finish.</p>
</section>
</section>
<section id="visualizing-results">
<h2>Visualizing results<a class="headerlink" href="#visualizing-results" title="Permalink to this headline"></a></h2>
<p>After finishing the simulation, you should be able to see different output files under the <strong>output</strong> directory. In this tutorial, you will learn how to process the fault output in .h5 format using Python. Hierarchical Data Format (HDF) is a set of file formats (HDF4, HDF5) designed to store and organize large amounts of scientific data. We assume that you already have some experience of using Python and installed h5py. If not, please refer to <a class="reference external" href="https://cuseistut.readthedocs.io/en/latest/pylith_static/index.html">our static simulation tutorial</a> .</p>
<section id="how-to-install-h5py">
<h3>How to install h5py<a class="headerlink" href="#how-to-install-h5py" title="Permalink to this headline"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda create --name pylith
$ conda activate pylith
$ conda install h5py
</pre></div>
</div>
<p>Please also make sure your have installed matplotlib in your environment. Now, let’s run the following commands.</p>
<div class="line-block">
<div class="line"><strong>1. Import the necessary packages</strong></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">manimation</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>2. Read the .h5 files</strong></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/ypbow/OneDrive/Desktop/mphil/teaching_modules/pylith_dynamic/output/v5/Nepal_dynamic_model-fault.h5&#39;</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>If you check <code class="docutils literal notranslate"><span class="pre">fields</span></code>, you would realize that there are four fields in this file - geometry, time, topology, and vertex_fields. In this tutorial, we will plot results using data from the vertices under <code class="docutils literal notranslate"><span class="pre">geometry</span></code>, time in <code class="docutils literal notranslate"><span class="pre">time</span></code> as well as the slip, slip rate, and traction under <code class="docutils literal notranslate"><span class="pre">vertex_fields</span></code>. For your reference, the figure below illustrates the general layout of a PyLith HDF5 file (extracted from the <a class="reference download internal" download="" href="../_downloads/cfabbbfae9e8c659ca211702f4bf23e5/pylith-2.2.2_manual.pdf"><code class="xref download docutils literal notranslate"><span class="pre">PyLith</span> <span class="pre">manual</span></code></a>).</p>
<a class="reference internal image-reference" href="../_images/hdf5_structure.png"><img alt="../_images/hdf5_structure.png" src="../_images/hdf5_structure.png" style="width: 80%;" /></a>
<p>figure 5. General layout of a PyLith HDF5 file. The orange rectangles with rounded corners identify the groups and the blue
rectangles with sharp corners identify the datasets. The dimensions of the data sets are shown in parentheses. Most HDF5 files
will contain either vertex_fields or cell_fields but not both. (Adopted from PyLith Manual)</p>
<div class="line-block">
<div class="line"><strong>3. Extract the data</strong></div>
</div>
<p>Since our simulation prescribed zero left-lateral shear traction, we will only focus on the updip shear traction and slip patterns in our plot.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/time&#39;</span><span class="p">)</span>
<span class="n">slip</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/vertex_fields/slip&#39;</span><span class="p">)</span>
<span class="n">slip_rate</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/vertex_fields/slip_rate&#39;</span><span class="p">)</span>
<span class="n">traction</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/vertex_fields/traction&#39;</span><span class="p">)</span>
<span class="n">geometry_vertices</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/geometry/vertices&#39;</span><span class="p">)</span>

<span class="n">x_vertex</span> <span class="o">=</span> <span class="n">geometry_vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>   <span class="c1"># along dip distance in km</span>
<span class="n">y_vertex</span> <span class="o">=</span> <span class="n">geometry_vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>   <span class="c1"># along strike distance in km</span>
<span class="n">dip_slip</span> <span class="o">=</span> <span class="n">slip</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>            <span class="c1"># updip slip in m</span>
<span class="n">dip_slip_rate</span> <span class="o">=</span> <span class="n">slip_rate</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># updip slip rate in m/s</span>
<span class="n">dip_traction</span> <span class="o">=</span> <span class="n">traction</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span>    <span class="c1"># updip traction in MPa</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>4. Make an animation for the updip slip distribution, slip rate, and traction during the rupture</strong></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the meta data for the movie</span>
<span class="n">FFMpegWriter</span> <span class="o">=</span> <span class="n">manimation</span><span class="o">.</span><span class="n">writers</span><span class="p">[</span><span class="s1">&#39;ffmpeg&#39;</span><span class="p">]</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;updip_fault_movie&#39;</span><span class="p">,</span> <span class="n">artist</span><span class="o">=</span><span class="s1">&#39;Matplotlib&#39;</span><span class="p">)</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">FFMpegWriter</span><span class="p">(</span><span class="n">fps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

<span class="c1"># Plot figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">15</span>

<span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">saving</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;updip_fault.mp4&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>    <span class="c1"># or .gif</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)):</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">scat</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_vertex</span><span class="p">,</span><span class="n">y_vertex</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">dip_slip</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span><span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">65</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Updip slip&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;along-dip (km)&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;along-strike (km)&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">180</span><span class="p">])</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">cbar1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cbar1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="n">cbar1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">reversed_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reversed</span><span class="p">()</span>
        <span class="n">scat</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_vertex</span><span class="p">,</span><span class="n">y_vertex</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">dip_slip_rate</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">reversed_map</span><span class="p">,</span><span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Updip slip rate&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;along-dip (km)&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;along-strike (km)&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">180</span><span class="p">])</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">cbar2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cbar2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
        <span class="n">cbar2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">reversed_map2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reversed</span><span class="p">()</span>
        <span class="n">scat</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_vertex</span><span class="p">,</span><span class="n">y_vertex</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">dip_traction</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">reversed_map2</span><span class="p">,</span><span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Updip traction&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;along-dip (km)&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;along-strike (km)&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">180</span><span class="p">])</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax3</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">cbar3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cbar3</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;MPa&#39;</span><span class="p">)</span>
        <span class="n">cbar3</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Time = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; s&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">0.77</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">17</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="c1">#plt.show()</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">grab_frame</span><span class="p">()</span>
</pre></div>
</div>
<p>You should be able to generate the following animation.</p>
<figure class="align-default">
<img alt="../_images/updip_fault.gif" src="../_images/updip_fault.gif" />
</figure>
<p>figure 6. An animation of the updip slip distribution, slip rate, and traction during the rupture</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../pylith_static/index.html" class="btn btn-neutral float-left" title="Static Stress Change - PyLith" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../body_tomo/index.html" class="btn btn-neutral float-right" title="Body Wave Tomography" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, CUSeisTut team.
      <span class="lastupdated">Last updated on 2022-04-18.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>